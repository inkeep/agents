import { Trigger } from '@inkeep/agents-sdk';
import { slackSigningSecret } from '../../credentials/slack-signing-secret';

export const slackWebhook = new Trigger({
  id: 'slack-webhook',
  name: 'Slack Webhook',
  messageTemplate: 'New Slack event: {{body.event.type}}',
  signatureVerification: {
    algorithm: 'sha256',
    encoding: 'hex',
    signature: {
      source: 'header',
      key: 'x-slack-signature',
      prefix: 'v0='
    },
    signedComponents: [
      {
        source: 'literal',
        value: 'v0',
        required: true
      },
      {
        source: 'header',
        key: 'x-slack-request-timestamp',
        required: true
      },
      {
        source: 'body',
        required: true
      },
    ],
    componentJoin: {
      strategy: 'concatenate',
      separator: ':'
    },
    validation: {
      headerCaseSensitive: false,
      allowEmptyBody: false,
      normalizeUnicode: false
    }
  },
  signingSecretCredentialReference: slackSigningSecret
});
