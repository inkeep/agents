---
title: Deploy to Vercel
description: Deploy the Inkeep Agent Framework to Vercel
icon: "brand/VercelIcon"
---

## Deploy to Vercel

### Step 1: Create a GitHub repository for your project

If you do not have an Inkeep project already, [follow these steps](/get-started/quick-start) to create one. Then push your project to a repository on GitHub.

### Step 2: Create a Postgres Database

Create a Postgres database on the [**Vercel Marketplace**](https://vercel.com/marketplace/neon) or directly at [**Neon**](https://neon.tech/).

### Step 3: Create a Doltgres Database

Create a Doltgres database at [**DoltHub**](https://hosted.doltdb.com).

### Step 4: Configure Database Connection

Set your database connection string as an environment variable:

```
# Doltgres Database
INKEEP_AGENTS_MANAGE_DATABASE_URL=
# Postgres Database
INKEEP_AGENTS_RUN_DATABASE_URL=
```

### Step 5: Create a Vercel account

Sign up for a Vercel account [here](https://vercel.com/signup).

### Step 6: Create a Vercel project for Manage API

![Vercel New Project - Manage API](/images/vercel-new-project-manage-api-hono.png)

<Note>
  The Framework Preset should be "Hono" and the Root Directory should be
  `apps/manage-api`.
</Note>

Required environment variables for Manage API:

```dotenv
ENVIRONMENT=production

INKEEP_AGENTS_MANAGE_API_BYPASS_SECRET=

# Doltgres Database
INKEEP_AGENTS_MANAGE_DATABASE_URL=
# Postgres Database
INKEEP_AGENTS_RUN_DATABASE_URL=

NANGO_SECRET_KEY=
NANGO_SERVER_URL=https://api.nango.dev
```

| Environment Variable                     | Value                                                                                                                                                              |
| ---------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `ENVIRONMENT`                            | `production`                                                                                                                                                       |
| `INKEEP_AGENTS_MANAGE_API_BYPASS_SECRET` | Run `openssl rand -hex 32` in your terminal to generate this value. Save this value for `INKEEP_AGENTS_MANAGE_API_BYPASS_SECRET` in Step 7.                        |
| `INKEEP_AGENTS_MANAGE_DATABASE_URL`      | Doltgres connection string from Step 3 (e.g., `postgresql://user:password@host:5432/database`)                                                                   |
| `INKEEP_AGENTS_RUN_DATABASE_URL`         | Postgres connection string from Step 4 (e.g., `postgresql://user:password@host:5433/database`)                                                                    |
| `NANGO_SECRET_KEY`                       | Nango secret key from your [Nango Cloud account](/typescript-sdk/credentials/nango). Note: Local Nango setup won't work with Vercel deployments. |
| `NANGO_SERVER_URL`                       | `https://api.nango.dev`                                                                                                                                            |

### Step 7: Create a Vercel project for Run API

![Vercel New Project - Run API](/images/vercel-new-project-run-api-hono.png)

<Note>
  The Framework Preset should be "Hono" and the Root Directory should be
  `apps/run-api`.
</Note>

Required environment variables for Run API:

```dotenv
ENVIRONMENT=production

ANTHROPIC_API_KEY=
OPENAI_API_KEY=
GOOGLE_GENERATIVE_AI_API_KEY=

INKEEP_AGENTS_RUN_API_BYPASS_SECRET=

# Postgres Database
INKEEP_AGENTS_RUN_DATABASE_URL=

OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=https://ingest.us.signoz.cloud:443/v1/traces
OTEL_EXPORTER_OTLP_TRACES_HEADERS=signoz-ingestion-key=<your-ingestion-key>

NANGO_SECRET_KEY=
NANGO_SERVER_URL=https://api.nango.dev

INKEEP_AGENTS_JWT_SIGNING_SECRET=
```

| Environment Variable                  | Value                                                                                                                                                                                                                                      |
| ------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `ENVIRONMENT`                         | `production`                                                                                                                                                                                                                               |
| `ANTHROPIC_API_KEY`                   | Your Anthropic API key                                                                                                                                                                                                                     |
| `OPENAI_API_KEY`                      | Your OpenAI API key                                                                                                                                                                                                                        |
| `GOOGLE_GENERATIVE_AI_API_KEY`        | Your Google Gemini API key                                                                                                                                                                                                                 |
| `INKEEP_AGENTS_RUN_API_BYPASS_SECRET` | Run `openssl rand -hex 32` in your terminal to generate this value. Save this value for `INKEEP_AGENTS_RUN_API_BYPASS_SECRET` in Step 7.                                                                                                   |
| `INKEEP_AGENTS_RUN_DATABASE_URL`      | Postgres connection string from Step 3 (e.g., `postgresql://user:password@host:5432/database`)                                                                                                                                            |
| `NANGO_SECRET_KEY`                    | Nango secret key from your [Nango Cloud account](/typescript-sdk/credentials/nango). Note: Local Nango setup won't work with Vercel deployments.                                                                         |
| `OTEL_EXPORTER_OTLP_TRACES_ENDPOINT`  | `https://ingest.us.signoz.cloud:443/v1/traces`                                                                                                                                                                                             |
| `OTEL_EXPORTER_OTLP_TRACES_HEADERS`   | `signoz-ingestion-key=<your-ingestion-key>`. Use the instructions from [SigNoz Cloud Setup](/get-started/traces#option-1-signoz-cloud-setup) to configure your ingestion key. Note: Local SigNoz setup won't work with Vercel deployments. |
| `NANGO_SERVER_URL`                    | `https://api.nango.dev`                                                                                                                                                                                                                    |
| `INKEEP_AGENTS_JWT_SIGNING_SECRET`    | Run `openssl rand -hex 32` in your terminal to generate this value. Save this value for `INKEEP_AGENTS_JWT_SIGNING_SECRET` in Step 7.                                                                                                      |

### Step 8: Create a Vercel project for Manage UI

![Vercel New Project - Manage UI](/images/vercel-new-project-manage-ui-nextjs.png)

<Note>
  The Framework Preset should be "Next.js" and the Root Directory should be
  `apps/manage-ui`.
</Note>

Required environment variables for Manage UI:

```dotenv
ENVIRONMENT=production

PUBLIC_INKEEP_AGENTS_RUN_API_URL=
PUBLIC_INKEEP_AGENTS_RUN_API_BYPASS_SECRET=

PUBLIC_INKEEP_AGENTS_MANAGE_API_URL=
INKEEP_AGENTS_MANAGE_API_URL=
INKEEP_AGENTS_MANAGE_API_BYPASS_SECRET=

PUBLIC_SIGNOZ_URL=https://<your-organization>.signoz.cloud
SIGNOZ_API_KEY=

PUBLIC_NANGO_SERVER_URL=https://api.nango.dev
PUBLIC_NANGO_CONNECT_BASE_URL=https://connect.nango.dev
NANGO_SECRET_KEY=
```

| Environment Variable                         | Value                                                                                                                                                                                          |
| -------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `ENVIRONMENT`                                | `production`                                                                                                                                                                                   |
| `PUBLIC_INKEEP_AGENTS_RUN_API_URL`           | Your Vercel deployment URL for Run API                                                                                                                                                         |
| `PUBLIC_INKEEP_AGENTS_RUN_API_BYPASS_SECRET` | Your generated Run API bypass secret from Step 6                                                                                                                                               |
| `PUBLIC_INKEEP_AGENTS_MANAGE_API_URL`        | Your Vercel deployment URL for Manage API (skip if same as `INKEEP_AGENTS_MANAGE_API_URL`)                                                                                                     |
| `INKEEP_AGENTS_MANAGE_API_URL`               | Your Vercel deployment URL for Manage API                                                                                                                                                      |
| `INKEEP_AGENTS_MANAGE_API_BYPASS_SECRET`     | Your generated Manage API bypass secret from Step 5                                                                                                                                            |
| `PUBLIC_SIGNOZ_URL`                          | Use the instructions from [SigNoz Cloud Setup](/get-started/traces#option-1-signoz-cloud-setup) to configure your SigNoz URL. Note: Local SigNoz setup won't work with Vercel deployments.     |
| `SIGNOZ_API_KEY`                             | Use the instructions from [SigNoz Cloud Setup](/get-started/traces#option-1-signoz-cloud-setup) to configure your SigNoz API key. Note: Local SigNoz setup won't work with Vercel deployments. |
| `NANGO_SECRET_KEY`                           | Nango secret key from your [Nango Cloud account](/typescript-sdk/credentials/nango). Note: Local Nango setup won't work with Vercel deployments.                             |
| `PUBLIC_NANGO_SERVER_URL`                    | `https://api.nango.dev`                                                                                                                                                                        |
| `PUBLIC_NANGO_CONNECT_BASE_URL`              | `https://connect.nango.dev`                                                                                                                                                                    |

### Step 9: Enable Vercel Authentication

To prevent anyone from being able to access the UI, we recommend enabling Vercel authentication for all deployments: **Settings > Deployment Protection > Vercel Authentication > All Deployments**.

### Step 10: Create a Vercel project for your MCP server (optional)

![Vercel New Project - MCP Server](/images/vercel-new-project-mcp.png)

<Note>
  The Framework Preset should be "Next.js" and the Root Directory should be
  `apps/mcp`.
</Note>

For more information on how to add MCP servers to your project, see [Create MCP Servers](/typescript-sdk/cli-reference#inkeep-add).

## Push your Agent

### Step 1: Configure your root .env file

```dotenv
INKEEP_AGENTS_MANAGE_API_BYPASS_SECRET=
INKEEP_AGENTS_RUN_API_BYPASS_SECRET=
```

### Step 2: Create a cloud configuration file

Create a new configuration file named `inkeep-cloud.config.ts` in your project's `src` directory, alongside your existing configuration file.

```typescript
import { defineConfig } from "@inkeep/agents-cli/config";

const config = defineConfig({
  tenantId: "default",
  agentsManageApi: {
    url: "https://<your-manage-api-url>",
    apiKey: process.env.INKEEP_AGENTS_MANAGE_API_BYPASS_SECRET,
  },
  agentsRunApi: {
    url: "https://<your-run-api-url>",
    apiKey: process.env.INKEEP_AGENTS_RUN_API_BYPASS_SECRET,
  },
});

export default config;
```

### Step 3: Push your Agent

```bash
cd /src/<your-project-directory>
inkeep push --config ../inkeep-cloud.config.ts
```

## Pull your Agent

```bash
cd /src
inkeep pull --config inkeep-cloud.config.ts
```

## Function Tools with Vercel Sandbox

When deploying to serverless environments like Vercel, you can configure [function tools](/typescript-sdk/tools/function-tools) to execute in [Vercel Sandbox](https://vercel.com/docs/vercel-sandbox) MicroVMs instead of your Agent's runtime service. This is **required** for serverless platforms since child process spawning is restricted.

### Why Use Vercel Sandbox?

**When to use each provider:**

- **Native** - Use for traditional cloud deployments (VMs, Docker, Kubernetes), self-hosted servers, or local development
- **Vercel Sandbox** - Required for serverless platforms (Vercel, AWS Lambda, etc.) or if you'd like to isolate tool executions

### Setting Up Vercel Sandbox

#### Step 1: Get Vercel Credentials

You'll need three credentials from your Vercel account:

1. **Vercel Token** - Create an access token at [vercel.com/account/tokens](https://vercel.com/account/tokens)
2. **Team ID** - Find in your team settings at [vercel.com/teams](https://vercel.com/teams)
3. **Project ID** - Find in your Vercel project settings

#### Step 2: Configure Sandbox in Your Application

Update your Run API to use Vercel Sandbox.

In the `apps/run-api/src` folder, create a `sandbox.ts` file:

```typescript sandbox.ts
const isProduction = process.env.ENVIRONMENT === "production";

export const sandboxConfig = isProduction
  ? {
      provider: "vercel",
      runtime: "node22", // or 'typescript'
      timeout: 60000, // 60 second timeout
      vcpus: 4, // Allocate 4 vCPUs
      teamId: process.env.SANDBOX_VERCEL_TEAM_ID!,
      projectId: process.env.SANDBOX_VERCEL_PROJECT_ID!,
      token: process.env.SANDBOX_VERCEL_TOKEN!,
    }
  : {
      provider: "native",
      runtime: "node22",
      timeout: 30000,
      vcpus: 2,
    };
```

Import it into your `index.ts` file:

```typescript index.ts
import { sandboxConfig } from "./sandbox.ts";
// ...
const app: Hono = createExecutionApp({
  // ...
  sandboxConfig, // NEW
});
```

#### Step 3: Add Environment Variables to Run API

Add these [environment variables in your Vercel project](https://vercel.com/docs/environment-variables/managing-environment-variables#declare-an-environment-variable) to your **Run API** app:

```dotenv
SANDBOX_VERCEL_TOKEN=your_vercel_access_token
SANDBOX_VERCEL_TEAM_ID=team_xxxxxxxxxx
SANDBOX_VERCEL_PROJECT_ID=prj_xxxxxxxxxx
```

<Accordions>
  <Accordion title="Troubleshooting Functions">
    <strong>"Failed to refresh OIDC token" error:</strong>
    <ul>
      <li>This occurs when you're not in a Vercel environment or you don't provide a Vercel access token</li>
      <li>
        Solution: Use a Vercel access token from
        <a href="https://vercel.com/account/tokens" target="_blank" rel="noopener noreferrer">vercel.com/account/tokens</a>
      </li>
    </ul>

    <strong>Function execution timeouts:</strong>
    <ul>
      <li>Increase the <code>timeout</code> value in sandbox configuration</li>
      <li>Consider allocating more <code>vcpus</code> for resource-intensive functions</li>
      <li>Check Vercel Sandbox limits for your plan</li>
    </ul>

    <strong>Dependency installation failures:</strong>
    <ul>
      <li>Ensure dependencies are compatible with Node.js 22</li>
      <li>Check that package versions are specified correctly</li>
      <li>Verify network access to npm registry</li>
    </ul>

    <strong>High costs:</strong>
    <ul>
      <li>Reduce <code>vcpus</code> allocation if functions don't need maximum resources</li>
      <li>Optimize function code to execute faster</li>
      <li>Consider caching results when possible</li>
    </ul>

  </Accordion>

  <Accordion title="Best Practices">
    <ol>
      <li><strong>Use environment variables</strong> – Never hardcode credentials</li>
      <li><strong>Start with fewer vCPUs</strong> – Scale up only if needed</li>
      <li><strong>Set reasonable timeouts</strong> – Prevent runaway executions</li>
      <li><strong>Monitor usage</strong> – Track sandbox execution metrics in Vercel dashboard</li>
      <li><strong>Test thoroughly</strong> – Verify functions work in sandbox environment before deploying</li>
      <li><strong>Choose the right provider</strong> – Use native for VMs/Docker/K8s, Vercel Sandbox for serverless only</li>
    </ol>
    <p>For more information on function tools, see:</p>
    <ul>
      <li>
        <a href="/typescript-sdk/tools/function-tools">Function Tools (TypeScript SDK)</a>
      </li>
      <li>
        <a href="/visual-builder/tools/function-tools">Function Tools (Visual Builder)</a>
      </li>
      <li>
        <a href="https://vercel.com/docs/vercel-sandbox" target="_blank" rel="noopener noreferrer">Vercel Sandbox Documentation</a>
      </li>
    </ul>
  </Accordion>
</Accordions>

## Deployment Protection

The Inkeep Agent Framework provides health endpoints for Kubernetes-style probes and optional integration with Vercel Checks for automated deployment protection.

### Health Endpoints

Two health endpoints are available for monitoring deployment readiness:

#### `/health` - Liveness Probe

A lightweight endpoint that returns immediately to indicate the service is running.

- **Response**: HTTP 204 (No Content)
- **Use case**: Kubernetes liveness probes, load balancer health checks
- **Latency**: Sub-millisecond (no external calls)

```bash
curl -I https://your-api.vercel.app/health
# HTTP/2 204
```

#### `/ready` - Readiness Probe

A comprehensive endpoint that verifies database connectivity before serving traffic.

- **Response (healthy)**: HTTP 200 with JSON status
- **Response (unhealthy)**: HTTP 503 with RFC 7807 Problem Details
- **Use case**: Kubernetes readiness probes, deployment verification

```bash
# Healthy response
curl https://your-api.vercel.app/ready
{
  "status": "ok",
  "manageDb": true,
  "runDb": true
}

# Unhealthy response (503 Service Unavailable)
{
  "type": "about:blank",
  "title": "Service Unavailable",
  "status": 503,
  "detail": "One or more health checks failed",
  "checks": {
    "manageDb": false,
    "runDb": true
  }
}
```

### Vercel Deployment Checks with GitHub Actions

Enable automated deployment protection using [Vercel Deployment Checks](https://vercel.com/docs/deployment-checks) combined with a GitHub Action. This approach blocks production deployments from being promoted until your health checks pass.

#### How It Works

1. **Deployment Created**: Vercel creates a production deployment but doesn't promote it yet
2. **GitHub Action Runs**: A workflow triggers when the deployment is ready and hits the `/ready` endpoint
3. **Status Reported**: The GitHub Action reports success/failure back to GitHub
4. **Vercel Reads Status**: Vercel reads the GitHub commit status and promotes the deployment only if checks pass

#### Step 1: Add the GitHub Action Workflow

The Inkeep Agent Framework includes a pre-configured workflow at `.github/workflows/deployment-health-check.yml`:

```yaml
name: Deployment Health Check

on:
  deployment_status:

jobs:
  health-check:
    if: github.event.deployment_status.state == 'success'
    runs-on: ubuntu-latest
    steps:
      - name: Wait for cold start
        run: sleep 10

      - name: Check /health endpoint (liveness)
        run: |
          curl -f -s -o /dev/null -w "%{http_code}" \
            "${{ github.event.deployment_status.target_url }}/health" \
            --retry 3 --retry-delay 5

      - name: Check /ready endpoint (readiness)
        run: |
          response=$(curl -f -s "${{ github.event.deployment_status.target_url }}/ready" \
            --retry 3 --retry-delay 5)
          echo "Response: $response"
          echo "$response" | jq -e '.status == "ok"'
```

#### Step 2: Enable Deployment Checks in Vercel

1. Ensure your project is connected to GitHub using [Vercel for GitHub](https://vercel.com/docs/git/vercel-for-github)
2. Go to **Project Settings > Deployment Checks**
3. Click **Add Checks** and select the `health-check` job from your GitHub Actions
4. Production deployments will now wait for the health check to pass before being promoted

#### Step 3: Test the Integration

1. Push a change to your default branch
2. Vercel creates a production deployment
3. The GitHub Action runs and checks the `/ready` endpoint
4. Once the check passes, Vercel promotes the deployment to your production domains

<Accordions>
  <Accordion title="Troubleshooting Deployment Checks">
    <strong>GitHub Action not running:</strong>
    <ul>
      <li>Ensure the workflow file exists at <code>.github/workflows/deployment-health-check.yml</code></li>
      <li>Verify the workflow is enabled in your repository's Actions settings</li>
    </ul>

    <strong>Check not appearing in Vercel:</strong>
    <ul>
      <li>Verify your project is connected to GitHub via Vercel for GitHub</li>
      <li>Ensure the check is selected in Project Settings > Deployment Checks</li>
    </ul>

    <strong>Health check fails but service is healthy:</strong>
    <ul>
      <li>The <code>/ready</code> endpoint checks database connectivity</li>
      <li>Ensure database connection strings are correct in the deployment</li>
      <li>Check database accessibility from the Vercel deployment region</li>
      <li>Increase the cold start wait time if needed</li>
    </ul>

    <strong>Bypassing checks:</strong>
    <ul>
      <li>Use <strong>Force Promote</strong> from the deployment details page in Vercel</li>
    </ul>
  </Accordion>
</Accordions>

## Staging and Production Deployment Strategy

This section explains how to configure Vercel for a staged deployment workflow where:
- Pushes to `main` create **staging** (preview) deployments
- GitHub releases trigger **production** deployments

This approach allows you to test changes on staging before promoting to production, with full control over production releases.

### Deployment Flow Overview

```mermaid
flowchart TD
    A[PR Created] --> B[Vercel Preview Deployment]
    C[PR Merged to main] --> D[Vercel Preview Deployment]
    D --> E[Staging Environment]
    F[GitHub Release Published] --> G[GitHub Action Triggered]
    G --> H[Deploy to Preview]
    H --> I[Wait for Checks]
    I --> J[Promote to Production]
```

### Step 1: Create a Placeholder Branch

Vercel requires the production branch to exist in your repository. Create an orphan branch that will never receive commits:

```bash
git checkout --orphan never-deploy
git rm -rf .
git commit --allow-empty -m "Placeholder branch to disable Vercel production deployments"
git push origin never-deploy
git checkout main
```

### Step 2: Configure Vercel Production Branch

1. Go to **Project Settings → Git** in the Vercel Dashboard
2. Under **Production Branch**, set the value to `never-deploy`
3. Save your changes

<Note>
  Since the `never-deploy` branch will never receive commits, Vercel will never trigger automatic production deployments. All pushes, including to `main`, will create preview deployments instead.
</Note>

After this configuration:
- Pushes to `main` create preview deployments
- Pushes to PR branches create preview deployments
- **No branch** triggers automatic production deployments

### Step 3: Configure GitHub Actions for Production Releases

The Inkeep Agent Framework includes a workflow that deploys to production when you publish a GitHub release. This integrates with the existing changesets release flow.

The workflow file is located at `.github/workflows/vercel-production.yml`:

```yaml
name: Deploy to Vercel Production

on:
  release:
    types: [published]

env:
  VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
  VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

jobs:
  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.release.tag_name }}

      - name: Install Vercel CLI
        run: npm install -g vercel

      - name: Pull Vercel Environment
        run: vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}

      - name: Build
        run: vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}

      - name: Deploy Preview for Checks
        id: deploy
        run: |
          DEPLOYMENT_URL=$(vercel deploy --prebuilt --token=${{ secrets.VERCEL_TOKEN }})
          echo "url=$DEPLOYMENT_URL" >> $GITHUB_OUTPUT
          echo "Deployed to: $DEPLOYMENT_URL"

      - name: Wait for Deployment Checks
        run: |
          echo "Waiting for Vercel deployment checks to complete..."
          vercel inspect ${{ steps.deploy.outputs.url }} --token=${{ secrets.VERCEL_TOKEN }} --wait

      - name: Promote to Production
        run: vercel promote ${{ steps.deploy.outputs.url }} --token=${{ secrets.VERCEL_TOKEN }}
```

**Key features:**
- **Triggered by GitHub releases**: Uses `release: types: [published]` to deploy only when you explicitly publish a release
- **Uses the tagged commit**: Checks out `github.event.release.tag_name` to ensure the exact release version is deployed
- **Deployment checks**: Deploys to a preview URL first, waits for Vercel Checks to pass, then promotes to production
- **Vercel CLI**: Uses `vercel deploy --prebuilt` for faster deployments with pre-built artifacts

### Step 4: Configure Required Secrets

The GitHub Actions workflow requires three secrets to authenticate with Vercel. Add these to your GitHub repository:

**Settings > Secrets and variables > Actions > New repository secret**

| Secret | Description | How to Obtain |
|--------|-------------|---------------|
| `VERCEL_TOKEN` | API token for Vercel CLI authentication | [Vercel Dashboard > Settings > Tokens](https://vercel.com/account/tokens) - Create a new token with appropriate scope |
| `VERCEL_ORG_ID` | Your Vercel team/organization ID | Run `vercel link` in your project, then check `.vercel/project.json` for `orgId` |
| `VERCEL_PROJECT_ID` | Your Vercel project ID | Run `vercel link` in your project, then check `.vercel/project.json` for `projectId` |

<Note>
  After running `vercel link`, your `.vercel/project.json` will contain both IDs:
  ```json
  {
    "orgId": "team_xxxxxxxxxxxx",
    "projectId": "prj_xxxxxxxxxxxx"
  }
  ```
  Copy these values to your GitHub repository secrets. **Do not commit** this file to your repository if it contains sensitive project identifiers.
</Note>

### Step 5: Optional Staging Domain Configuration

For easier access to your staging environment, you can configure a custom domain that always points to your `main` branch deployments.

1. Go to **Project Settings → Domains** in the Vercel Dashboard
2. Click **Add Domain**
3. Enter your staging domain (e.g., `api-staging.agents.yourdomain.com`)
4. Under **Git Branch**, select `main`
5. Save your changes

Vercel will automatically:
- Route traffic for the staging domain to the latest `main` branch deployment
- Provision an SSL certificate for the domain
- Update the deployment whenever `main` is updated

**Example domain configuration:**

| Domain | Branch | Purpose |
|--------|--------|---------|
| `api-staging.agents.yourdomain.com` | `main` | Staging environment for testing |
| `api.agents.yourdomain.com` | Production | Production (deployed via GitHub releases) |

### Creating a Production Release

With this configuration, the production deployment flow is:

1. **Merge PRs to main**: Changes go to staging automatically
2. **Test on staging**: Verify changes at your staging domain (e.g., `api-staging.agents.yourdomain.com`)
3. **Create a GitHub release**: Use the changesets workflow or manually create a release
4. **Automatic production deployment**: The GitHub Action builds, verifies, and promotes to production

```bash
# Using changesets (recommended)
pnpm changeset
git add .
git commit -m "chore: version packages"
git push

# When the "Version Packages" PR is merged, the release workflow creates a GitHub release
# which triggers the production deployment
```

<Accordions>
  <Accordion title="Troubleshooting Staging/Production Deployments">
    <strong>Main branch still deploying to production:</strong>
    <ul>
      <li>Verify Production Branch is set to <code>never-deploy</code> in Project Settings → Git</li>
      <li>Ensure the <code>never-deploy</code> branch exists in your repository</li>
      <li>Check that you saved the changes in the Vercel Dashboard</li>
    </ul>

    <strong>GitHub Action not triggering:</strong>
    <ul>
      <li>Ensure the workflow file exists at <code>.github/workflows/vercel-production.yml</code></li>
      <li>Verify the release is <strong>published</strong>, not just a draft</li>
      <li>Check GitHub Actions is enabled for your repository</li>
    </ul>

    <strong>Deployment fails with authentication error:</strong>
    <ul>
      <li>Verify all three secrets are configured: <code>VERCEL_TOKEN</code>, <code>VERCEL_ORG_ID</code>, <code>VERCEL_PROJECT_ID</code></li>
      <li>Check that the Vercel token has not expired</li>
      <li>Ensure the token has permissions for the target project</li>
    </ul>

    <strong>Staging domain not updating:</strong>
    <ul>
      <li>Verify the domain is configured with Git Branch set to <code>main</code> in Project Settings → Domains</li>
      <li>Check DNS propagation if recently configured</li>
      <li>Ensure the deployment completed successfully</li>
    </ul>

    <strong>Promote step fails:</strong>
    <ul>
      <li>The <code>vercel promote</code> command requires the deployment URL from the previous step</li>
      <li>Check that deployment checks passed before promotion</li>
      <li>Verify the deployment wasn't cancelled or deleted</li>
    </ul>
  </Accordion>
</Accordions>
