---
title: Deploy to Azure VM
sidebarTitle: Azure VM
description: Deploy to Azure VM with Docker Compose
icon: LuServerCog
---

## Create a VM Instance

- Go to [Compute infrastructure | Virtual machines](https://portal.azure.com/#blade/Microsoft_Azure_ComputeHub/ComputeHubMenuBlade/virtualMachinesBrowse) in your Azure Portal.
- Create a virtual machine
- Select a subscription and resource group
- Assign a name for the virtual machine
- Assign a region (e.g. `(US) East US 2`)
- For Availability options, select `No infrastructure redundancy required`
- Use image: `Ubuntu Server 24.04 LTS - x64 Gen2`
- Recommended size is at least `Standard_D2s_v3` (2 vcpus, 8 GiB memory).
- Configure SSH (you will need to SSH into the VM)
- In the "Disks" tab, confirm the OS disk size is at least 128 GiB (P10).
- In the "Networking" tab, assign public IP address
- Click on "Review + create"
- After the VM is running, go to the "Network Settings" page under "Networking"
- Add inbound security rule for TCP ports: 3000,3002,3050,3051,3080

## Install Docker Compose

1. [SSH into the VM](https://learn.microsoft.com/en-us/azure/virtual-machines/linux-vm-connect?tabs=Linux)

2. [Set up Docker's apt repository](https://docs.docker.com/engine/install/ubuntu/)
```bash
# Add Docker's official GPG key:
sudo apt update
sudo apt install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# Add the repository to Apt sources:
sudo tee /etc/apt/sources.list.d/docker.sources <<EOF
Types: deb
URIs: https://download.docker.com/linux/ubuntu
Suites: $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}")
Components: stable
Signed-By: /etc/apt/keyrings/docker.asc
EOF

sudo apt update
```

3. Install the Docker packages
```bash
sudo apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

4. Grant permissions
```
sudo usermod -aG docker $USER
newgrp docker
```

## Deploy SigNoz and Nango

<Snippet file="self-hosting/deploy-signoz-nango.mdx" />

## Deploy the Inkeep Agent Framework

<Snippet file="self-hosting/deploy-inkeep-agents.mdx" />

## Production

For a production deployment, you will want to restrict access to the VM and only expose 3002. To do this, we'll setup an Application Gateway and a Front Door (with https).

### Application Gateway
- On the VM page, under "Networking" > "Load balancing", click on "Add load balancing" and create a new "Application Gateway"
- Provide a name for the gateway and a name for the routing rule. The routing rule should be configured to Port 80 HTTP.
- Wait for the gateway to deploy (can take >5 mins)
- On the gateway page, under "Settings" > "Backend pools", click on the pool. Under "Backend targets", add a target of type "Virtual machine" and select your VM.
- On the gateway page, under "Settings" > "Backend Settings", change the "Backend port" to 3002.
- On the gateway page, under "Settings" > "Health probes", add a new health probe. Provide a name, select HTTP for protocol. For the host use `127.0.0.1`, `3002` for the port, and `/health` for the path. "Pick host name from backend settings" and "Pick port from backend settings" should be "No". Then select your "Backend settings".

### Front Door
- Create an Azure Front Door. Continue with "Quick create".
- For the origin, select the "Application Gateway" you created.
- Disable caching.
- You will be assigned an autogenerated url with https from Azure. To add a custom domain, go to "Settings" > "Domains".

### Data Retention

By default, the retention period for conversation data and traces is set to 15 days. To set a longer retention period, navigate to the **General** tab on the **Settings** page in SigNoz.

### Restrict VM Access
- Modify the inbound security rules, for example, to only specific IPs. You will need this for building agents.
- All external access should only use the gateway and front door.
