---
title: Register and use MCP Servers
sidebarTitle: Register MCP Servers
description: Learn how to add and configure MCP servers for your agents
icon: "LuHammer"
---

MCP tools connect to external servers that implement the MCP standard. This allows you to integrate with a wide ecosystem of existing tools and services.

<Snippet file="mcp/intro-create-and-add.mdx" />

### Registring an MCP Server

```typescript
import { agent, mcpTool } from "@inkeep/agents-sdk";

const knowledgeBaseTool = mcpTool({
  id: "knowledge-base-tool",
  name: "knowledge_base",
  description: "Search the company knowledge base for information",
  serverUrl: "https://kb.yourcompany.com/mcp",
});

const qaAgent = subAgent({
  id: "qa-agent",
  name: "QA Agent",
  description: "Responsible for answering questions about the company knowledge base.",
  prompt: `You are a Question-Answer agent that can answer questions about the company knowledge base.
  You have access to the knowledge base tool to search for information.`,
  canUse: () => [knowledgeBaseTool],
});
```

<Note>Tip: When adding tools to an agent, you can also reference the tool in the agent's prompt to help the agent understand how to use the tool.</Note>

## Authentication

MCP servers support various authentication methods (via credentials):

- **No Authentication** - For public APIs or internal services
- **API Key** - For services requiring API keys
- **Bearer Token** - For JWT or similar token-based authentication
- **Token Authentication** - For custom token schemes
- **OAuth Flows** - For standard OAuth 2.0 authentication
- **OAuth 2.1 Flows** - For modern OAuth 2.1 "1-click" authentication

For OAuth flows and OAuth 2.1 flows, it's recommended to use the [Visual Builder](/visual-builder/tools/mcp-servers) for easier configuration.

See [Credentials](/typescript-sdk/tools/credentials) for detailed examples and implementation guidance for each authentication type.

### Custom Headers

You can configure custom headers for your MCP server requests. Use credentials for sensitive information (API keys, tokens) and headers for non-sensitive metadata (user agent, version info, etc.).

```typescript
import { mcpTool } from "@inkeep/agents-sdk";

const customHeadersTool = mcpTool({
  id: "enterprise-api",
  name: "enterprise_data",
  description: "Enterprise API with custom headers",
  serverUrl: "https://enterprise.example.com/mcp",
  headers: {
    "User-Agent": "Inkeep-Agent/1.0",
    "X-Client-Version": "2024.1",
  },
});
```

## Selecting Tools

### Selective Tool Activation

Enable only specific tools from a server using MCP Server tool names in the `activeTools` field.

```typescript
import { mcpTool } from "@inkeep/agents-sdk";

const selectiveTool = mcpTool({
  id: "limited-server",
  name: "analytics_readonly",
  description: "Analytics server with limited access",
  serverUrl: "https://analytics.example.com/mcp",
  activeTools: ["get_metrics", "generate_report"], // Only these tools
});
```

### Using `with` for Tool Selection

While `activeTools` in `mcpTool` limits which tools are available from the server, you can further refine tool access at the agent level using `mcpTool.with`. This allows different agents to use different subsets of tools from the same MCP server.

```typescript
import { agent, mcpTool } from "@inkeep/agents-sdk";

// Define the MCP server with all available tools
const echoTool = mcpTool({
  id: "echo-tool",
  name: "Echo tool",
  serverUrl: "https://mcp-for-next-js-seven-iota.vercel.app/mcp",
});

// Agent that only uses specific tools from the server
const weatherAssistant = subAgent({
  id: "weather-assistant",
  name: "Weather assistant",
  description: "Responsible for routing between the geocoder agent and weather forecast agent",
  prompt: "You are a helpful assistant. When the user asks about the weather in a given location, first ask the geocoder agent for the coordinates, and then pass those coordinates to the weather forecast agent to get the weather forecast",
  canDelegateTo: () => [weatherForecaster, geocoderAgent],
  canUse: () => [echoTool.with({ selectedTools: ["echo2"], headers: { "X-Custom-Header": "custom-value" } })],
});
```

## Environment-Aware MCP Servers

You can also configure MCP servers to switch based on your environment. This is useful when you want to use different MCP servers configurationsfor development vs production.

```typescript
import { environmentMcpTool } from "@inkeep/agents-sdk";

const echoTool = environmentMcpTool({
  id: "echo-tool",
  name: "Echo tool",
  serverUrl: "https://mcp-for-next-js-seven-iota.vercel.app/mcp",
});
```

You can also configure entire MCP tools to switch based on your environment. This is useful when you want to use different MCP servers or configurations for development vs production.

### Basic Setup Example

<Tabs>
  <Tab title="Development Config">
    ```typescript title="environments/development.env.ts"
    import { registerEnvironmentSettings } from '@inkeep/agents-sdk';
    import { CredentialStoreType } from '@inkeep/agents-core';


    export const development = registerEnvironmentSettings({
      mcpServers: {
        'inkeep-mcp': mcpTool({
          id: 'my-inkeep-mcp',
          name: 'Inkeep MCP',
          description: 'Inkeep MCP for development',
          serverUrl: 'http://localhost:3000/mcp',
          transport: { type: 'streamable_http' },
        })
      },
    });
    ```
  </Tab>

  <Tab title="Production Config">
    ```typescript title="environments/production.env.ts"
    import { registerEnvironmentSettings } from '@inkeep/agents-sdk';
    import { CredentialStoreType } from '@inkeep/agents-core';

    export const production = registerEnvironmentSettings({
      mcpServers: {
        'inkeep-mcp': mcpTool({
          id: 'my-inkeep-mcp',
          name: 'Inkeep MCP',
          description: 'Inkeep MCP for production',
          serverUrl: 'https://inkeep-mcp-prod.com/mcp',
          credential: {
            id: 'inkeep-mcp-credential',
            type: CredentialStoreType.memory,
            credentialStoreId: 'memory-default',
            retrievalParams: {
              key: 'INKEEP_MCP_KEY_PROD',
            },
          },
        })
      },
    });
    ```
  </Tab>

  <Tab title="Index File">
    ```typescript title="environments/index.ts"
    import { createEnvironmentSettings } from '@inkeep/agents-sdk';
    import { development } from './development.env';
    import { production } from './production.env';

    export const envSettings = createEnvironmentSettings({
      development,
      production,
    });
    ```
  </Tab>
</Tabs>