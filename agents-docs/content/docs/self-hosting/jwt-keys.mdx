---
title: JWT Key Management
sidebarTitle: JWT Keys
description: Managing RSA keys for temporary token authentication
icon: "LuKey"
---

## Overview

The Inkeep Agent Framework uses RSA-signed JWTs for temporary playground tokens. This provides stateless authentication without database overhead.

## Generating Keys

For production deployments, generate RSA key pairs using the provided script:

```bash
# From project root
chmod +x scripts/generate-jwt-keys.sh
./scripts/generate-jwt-keys.sh
```

This will generate:
- **Private key** (2048-bit RSA) - for manage-api to sign tokens
- **Public key** - for run-api to verify tokens

The script outputs base64-encoded keys ready for environment variables.

## Manual Key Generation

If you prefer to generate keys manually:

```bash
# Generate private key
openssl genrsa -out jwt-private-key.pem 2048

# Extract public key
openssl rsa -in jwt-private-key.pem -pubout -out jwt-public-key.pem

# Convert to base64 for environment variables
base64 -i jwt-private-key.pem | tr -d '\n'
base64 -i jwt-public-key.pem | tr -d '\n'
```

## Environment Configuration

**manage-api (.env):**
```bash
INKEEP_AGENTS_TEMP_JWT_PRIVATE_KEY=<base64-encoded-private-key>
```

**run-api (.env):**
```bash
INKEEP_AGENTS_TEMP_JWT_PUBLIC_KEY=<base64-encoded-public-key>
```

## Security Best Practices

### Private Key Security

The private key must be kept secret:
- ✅ Store in environment variables (never commit to git)
- ✅ Only deploy to manage-api (never to run-api)
- ✅ Use secrets management (AWS Secrets Manager, Vault, etc.)
- ✅ Rotate regularly (see Key Rotation below)

### Public Key Distribution

The public key can be safely shared:
- ✅ Can be committed to git if needed
- ✅ Deploy to run-api
- ✅ Can be exposed via `/.well-known/jwks.json` (future enhancement)

## Key Rotation

To rotate keys without downtime:

### Step 1: Generate New Key Pair

```bash
./scripts/generate-jwt-keys.sh
```

### Step 2: Update manage-api

Deploy new private key to manage-api:
```bash
INKEEP_AGENTS_TEMP_JWT_PRIVATE_KEY=<new-private-key>
```

manage-api will start signing tokens with the new key immediately.

### Step 3: Grace Period

Wait 1 hour (max token lifetime) while:
- New tokens signed with new key
- Old tokens still valid (verified with old public key)

### Step 4: Update run-api

After grace period, deploy new public key to run-api:
```bash
INKEEP_AGENTS_TEMP_JWT_PUBLIC_KEY=<new-public-key>
```

## JWT Token Structure

Temporary tokens contain these claims:

```json
{
  "alg": "RS256",
  "typ": "JWT",
  "sub": "user-id",
  "iss": "inkeep-manage-api",
  "aud": "inkeep-run-api",
  "iat": 1234567890,
  "exp": 1234571490,
  "jti": "unique-token-id",
  "tenantId": "default",
  "projectId": "my-project",
  "agentId": "my-agent",
  "type": "temporary",
  "initiatedBy": {
    "type": "user",
    "id": "user-123"
  }
}
```

## Troubleshooting

### "Temporary token signing not configured"

**Cause:** `INKEEP_AGENTS_TEMP_JWT_PRIVATE_KEY` not set in manage-api

**Fix:**
1. Generate keys using `./scripts/generate-jwt-keys.sh`
2. Add private key to manage-api .env
3. Restart manage-api

### "JWT verification failed"

**Cause:** Mismatched keys or expired token

**Fixes:**
- Verify public key in run-api matches private key in manage-api
- Check token hasn't expired (1-hour lifetime)
- Ensure base64 encoding is correct (no line breaks)

### Token Refresh Not Working

**Cause:** Frontend not detecting 401 errors

**Fix:**
- Check browser console for refresh logs
- Verify `onEvent` handler is catching error events
- Ensure session cookie is still valid

## Development vs Production

### Development
- Keys optional (bypass secret can be used instead)
- Warnings logged if keys not configured

### Production
- Keys required for playground functionality
- Regular API keys still work (database-backed)
- Both systems co-exist (JWT for playground, API keys for programmatic access)

