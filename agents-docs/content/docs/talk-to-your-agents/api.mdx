---
title: How to call your AI Agent Graph via a Vercel AI SDK format API
sidebarTitle: API (AI SDK format)
description: Use a raw HTTP request to stream responses from your agent graph over the Vercel AI SDK data stream protocol.
icon: LuNetwork
keywords: API, Vercel AI SDK, streaming, SSE, data stream, agents, chat
---

## Overview

This guide shows how to call your agent graph directly over HTTP and stream responses using the Vercel AI SDK data stream format. It covers the exact endpoint, headers, request body, and the event stream response you should expect.

<Tip>
  If you are building a React UI, consider our prebuilt components under [React UI Components](/talk-to-your-agents/react/chat-button). This page is for low-level HTTP usage.
</Tip>

## Endpoint

- **Path (mounted by the Run API):** `/api/chat`
- **Method:** `POST`
- **Protocol:** Server-Sent Events (SSE) encoded JSON, using Vercel AI SDK data-stream v2
- **Content-Type (response):** `text/event-stream`
- **Response Header:** `x-vercel-ai-data-stream: v2`

## Get an INKEEP_API_KEY (Authentication Modes)

There are three ways to authenticate requests to the Run API. Choose one and follow the header requirements below.

### 1. Standard API Key (Recommended)

- **What it is:** Per-graph secret created via the Management UI or the Management API
- **Scope:** Encodes `tenantId`, `projectId`, and `graphId` inside the key
- **Headers needed:** Only `Authorization: Bearer <key>` (no scope headers)

**Steps to create:**

1. Use the Management UI (Project → API Keys → Create)
2. Or call the Management API (returns the full key once):

```bash
# POST /tenants/{tenantId}/crud/projects/{projectId}/api-keys
curl -X POST "https://<manage-api>/tenants/<tenantId>/crud/projects/<projectId>/api-keys" \
  -H "Content-Type: application/json" \
  -d '{ "graphId": "<graph-id>", "expiresAt": null }'
```

<Note>
  See [Authentication → Run API](/api-reference/authentication/run-api) for more details.
</Note>

### 2. Global Bypass Secret (Infrastructure/Internal Use)

- **What it is:** Environment variable set on the Run API server
- **Configuration:** Set `INKEEP_AGENTS_RUN_API_BYPASS_SECRET` on the server
- **Headers needed:** Bearer token plus all scope headers

### 3. Development Mode

- **When:** `ENVIRONMENT=development` on the Run API server
- **Authentication:** No API key required
- **Headers needed:** Scope headers to specify the tenant/project/graph

## Headers by Mode

### Standard API Key
```http
Authorization: Bearer <graph_api_key>
```
No `x-inkeep-*` scope headers required.

### Global Bypass Secret
```http
Authorization: Bearer <bypass_secret>
x-inkeep-tenant-id: <tenant-id>
x-inkeep-project-id: <project-id>
x-inkeep-graph-id: <graph-id>
```

### Development Mode
```http
x-inkeep-tenant-id: <tenant-id>
x-inkeep-project-id: <project-id>
x-inkeep-graph-id: <graph-id>
```
`Authorization` header is optional in development mode.

## Request Body Schema

```json
{
  "messages": [
    {
      "role": "user",
      "content": "Hello!"
    }
  ],
  "conversationId": "optional-conversation-id",
  "requestContext": { "any": "validated per your graph config" }
}
```

**Field Notes:**

- **`messages`** — Must include at least one `user` message
- **`content`** — Can be a string or an object with `parts` for multi-part content
- **`conversationId`** — Optional; server generates one if omitted
- **`requestContext`** — Optional; validated against your graph's context configuration if present

### Example cURL (Standard API Key)

```bash
curl -N \
  -X POST "http://localhost:3003/api/chat" \
  -H "Authorization: Bearer $INKEEP_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      { "role": "user", "content": "What can you do?" }
    ],
    "conversationId": "chat-1234"
  }'
```

### Example cURL (Global Bypass Secret)

```bash
curl -N \
  -X POST "http://localhost:3003/api/chat" \
  -H "Authorization: Bearer $INKEEP_AGENTS_RUN_API_BYPASS_SECRET" \
  -H "x-inkeep-tenant-id: your-tenant-id" \
  -H "x-inkeep-project-id: your-project-id" \
  -H "x-inkeep-graph-id: your-graph-id" \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      { "role": "user", "content": "What can you do?" }
    ]
  }'
```

## Response: Vercel AI SDK Data Stream (v2)

The response is an SSE stream of JSON events compatible with the Vercel AI SDK UI message stream. The server sets `x-vercel-ai-data-stream: v2`.

### Event Types

- **`text-start`** — Indicates a new text segment is starting
- **`text-delta`** — Carries the text content delta for the current segment
- **`text-end`** — Marks the end of the current text segment
- **`data-component`** — Structured UI data emitted by the agent (for rich UIs)
- **`data-artifact`** — Artifact data emitted by tools/agents
- **`data-operation`** — Operational events (status updates, completion, errors)
- **`error`** — Error message emitted by the server/agent

### Example Stream (abbreviated)

```text
: keep-alive

data: {"type":"text-start","id":"1726247200-abc123"}

data: {"type":"text-delta","id":"1726247200-abc123","delta":"Hello! I can help with..."}

data: {"type":"text-end","id":"1726247200-abc123"}

data: {"type":"data-operation","data":{"type":"status_update","ctx":{"summary":"Searched docs"}}}

data: {"type":"data-component","id":"1726247200-abc123-0","data":{"type":"customer-info","name":"Ada","email":"ada@example.com"}}

data: {"type":"data-artifact","data":{"artifact_id":"art_abc","task_id":"task_xyz","summary":{}}}
```

### Operation Events

`data-operation` events conform to an internal schema. Common types include:

- **`agent_initializing`** — The agent runtime is starting
- **`agent_ready`** — Agent is ready
- **`agent_thinking`** — Agent is processing
- **`status_update`** — Progress update; may include `label` and structured `ctx` data
- **`completion`** — The agent completed the task
- **`error`** — Error information (also emitted as a top-level `error` event)

### Text Streaming Behavior

- For each text segment, the server emits `text-start` → `text-delta` → `text-end`
- The server avoids splitting content word-by-word; a segment is usually a coherent chunk
- Operational events are queued during active text emission and flushed shortly after to preserve ordering and readability

## Error Responses

### Streamed Errors
```json
{ "type": "error", "errorText": "<message>" }
```

### Non-Streaming Errors
Validation failures and other errors return JSON with an appropriate HTTP status code.

## HTTP Status Codes

- **`200`** — Stream opened successfully
- **`401`** — Missing/invalid authentication
- **`404`** — Graph or agent not found
- **`400`** — Invalid request body/context
- **`500`** — Internal server error

## Development Notes

- **Default local base URL:** `http://localhost:3003`
- **Endpoint mounting in the server:**
  - `/api/chat` → Vercel data stream (this page)
  - `/v1/mcp` → MCP JSON-RPC endpoint

<Note>
  To test quickly without a UI, use `curl -N` or a tool that supports Server-Sent Events.
</Note>
