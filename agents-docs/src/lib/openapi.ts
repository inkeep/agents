import { createOpenAPI } from 'fumadocs-openapi/server';
import { readFileSync } from 'node:fs';
import { resolve } from 'node:path';

// Read the OpenAPI spec from the local monorepo (generated by agents-api export-openapi script)
function loadLocalSpec() {
  const specPath = resolve(process.cwd(), '../agents-api/openapi-spec.json');
  const specContent = readFileSync(specPath, 'utf-8');
  return JSON.parse(specContent);
}

export const openapi = createOpenAPI({
  // Read the OpenAPI spec from the local monorepo instead of remote URLs.
  // This enables offline builds and ensures docs are always in sync with the codebase.
  // The spec is generated by running `pnpm export-openapi` in agents-api.
  input: () => ({
    'agents-api': loadLocalSpec(),
  }),
});
