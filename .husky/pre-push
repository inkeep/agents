#!/bin/sh
# Pre-push hook for Agent Framework
# 
# This hook runs before each push to ensure code quality.
# It runs a single optimized turbo command that:
#   - Builds once (cached and reused by all tasks)
#   - Runs lint, typecheck, and test in optimal order
#
# Usage:
#   Normal push:                      git push
#   Skip all hooks (use sparingly):   git push --no-verify
#
# For more information, see CONTRIBUTING.md

# Get current branch name
BRANCH_NAME=$(git symbolic-ref --short HEAD)

# Only run hooks on main branch
if [ "$BRANCH_NAME" != "main" ]; then
  echo "‚ö° Skipping pre-push hooks (not on main branch)"
  exit 0
fi

echo "üöÄ Running pre-push checks with optimized caching..."
echo "   This runs build once and shares it across lint, typecheck, and test"

# Run the unified check command that handles all validations efficiently
if ! pnpm check; then
  echo "‚ùå Pre-push checks failed. Fix the issues above before pushing."
  exit 1
fi

echo "‚úÖ All pre-push checks passed!"