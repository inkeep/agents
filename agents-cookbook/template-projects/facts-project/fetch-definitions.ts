import { fetchDefinition } from '@inkeep/agents-core';
import { projectAutogenInfoSchema } from './schemas';

// Then create your fetch definition with the GraphQL query
export const projectDescriptionFetchDefinition = fetchDefinition({
  id: 'project-info',
  name: 'Project Information',
  trigger: 'initialization',
  fetchConfig: {
    url: 'https://api.management.inkeep.com/graphql',
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${process.env.INKEEP_API_KEY}`,
    },
    body: {
      query: `
      query GetProjectAutogenInfo {
        projectByIntegrationAuth {
          chatSubjectName
          botCreator
          botName
          oneLineDescription
          primaryLanguage
          autogeneratedDescription
          productLines {
            aliases
            description
            integrations
            primaryTerm
            versions {
                name
                aliases
                description
                releaseDate
                isLatest
            }
          }
          keyTerms {
            primaryTerm
            aliases
            category
            definition
            example
          }
        }
      }`,
    },
    // Transform the GraphQL response to extract just the project data
    transform: 'data.projectByIntegrationAuth',
  },

  // Response schema validation (expects the string result after transform)
  responseSchema: projectAutogenInfoSchema,

  // Fallback data if the request fails
  defaultValue: 'Unable to fetch project information',
});
